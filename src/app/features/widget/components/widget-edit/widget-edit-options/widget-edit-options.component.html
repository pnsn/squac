<div class="edit-body">
  <form #optionsEditForm [formGroup]="optionsForm">
    <div class="head-row">
      <span class="label">{{ widgetType?.name | titlecase }} Options</span>
    </div>

    <p class="help-text">{{ widgetType?.displayInfo }}</p>

    <ng-container formGroupName="options" *ngIf="widgetType?.displayOptions">
      <div class="">
        <div class="body-row">
          <mat-radio-group
            formControlName="displayType"
            class="radio-button-group"
          >
            <mat-radio-button
              *ngFor="let type of widgetType?.displayOptions"
              [value]="type.displayType"
            >
              <span>
                {{ type.description }}
              </span>
            </mat-radio-button>
          </mat-radio-group>
        </div>
      </div>

      <div class="head-row">
        <span class="label">Colors</span>
      </div>
      <p class="help-text">
        If # of splits is 0 the colors will be continuous. If # of splits > 0,
        the colors will be evenly split.
      </p>
      <div class="body-row">
        <mat-form-field class="small">
          <mat-label>In Range</mat-label>
          <mat-select #inRange formControlName="inRange">
            <mat-select-trigger *ngIf="inRange && inRange.value">
              <span
                *ngIf="
                  inRange.value.color && inRange.value.color.length === 1;
                  else gradient
                "
                class="color-indicator"
                [ngStyle]="{
                  'background-color': inRange.value.color[0]
                }"
              ></span>

              <ng-template #gradient>
                <span
                  class="gradient-indicator"
                  [ngStyle]="{
                    'background-image':
                      'linear-gradient(to right, ' + colors(inRange.value) + ')'
                  }"
                ></span>
              </ng-template>
            </mat-select-trigger>

            <mat-option *ngFor="let opt of gradientOptions" [value]="opt">
              <span
                class="gradient-indicator"
                [ngStyle]="{
                  'background-image':
                    'linear-gradient(to right, ' + colors(opt) + ')'
                }"
              ></span>
              <span>
                {{ opt.label }}
              </span>
            </mat-option>
            <mat-option *ngFor="let opt of solidOptions" [value]="opt">
              <span
                *ngIf="opt.color.length === 1"
                class="color-indicator"
                [ngStyle]="{
                  'background-color': opt.color[0]
                }"
              ></span>
              <span>
                {{ opt.label }}
              </span>
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="small">
          <mat-label>Out of Range</mat-label>
          <mat-select #outOfRange formControlName="outOfRange">
            <mat-select-trigger>
              <span
                *ngIf="outOfRange.value"
                class="color-indicator"
                [ngStyle]="{
                  'background-color': outOfRange.value.color[0]
                }"
              ></span>
            </mat-select-trigger>
            <mat-option *ngFor="let range of solidOptions" [value]="range">
              <span
                class="color-indicator"
                [ngStyle]="{
                  'background-color': range.color[0]
                }"
              ></span>
              {{ range.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="xsmall">
          <mat-label># of splits</mat-label>
          <input
            matInput
            type="number"
            name="numSplits"
            max="5"
            min="0"
            formControlName="numSplits"
          />
        </mat-form-field>
      </div>
    </ng-container>

    <ng-container *ngIf="widgetType?.displayOptions">
      <p class="help-text">Select which metric(s) to show on the widget.</p>
      <ng-container formArrayName="dimensions">
        <ng-container
          *ngFor="let metric of dimensions?.controls; let i = index"
        >
          <div [formGroupName]="i" class="body-row metric-select-container">
            {{ dimensions.controls[i].value.type }} metric:
            <mat-form-field class="dense-form-field-select">
              <mat-select #metric formControlName="metricId">
                <mat-option *ngFor="let m of selectedMetrics" [value]="m.id">
                  {{ m.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </ng-container>
      </ng-container>

      <div class="head-row">
        <span class="label">Thresholds</span>
        <button mat-button (click)="addThreshold()">
          <mat-icon> add </mat-icon>add
        </button>
      </div>
      <p class="help-text">
        Values between or equal to the min and max will be 'in range'. If # of
        splits = 0 and if min or max is not set, they will default to the data
        min or max. If # of splits > 0 and if min or max is not set, they will
        default to -Infinity or +Infinity.
      </p>
      <ng-container formArrayName="thresholdArray">
        <div id="thresholds-table">
          <div class="body-row">
            <div class="large">metric(s)</div>

            <div class="xsmall">min</div>
            <div class="xsmall">max</div>
            <div class="xsmall"></div>
          </div>
          <ng-container
            *ngFor="let threshold of thresholdArray.controls; let i = index"
          >
            <div [formGroupName]="i" class="body-row">
              <div class="large">
                <mat-form-field class="dense-form-field-select">
                  <mat-select #metric formControlName="metrics" multiple>
                    <mat-select-trigger>
                      {{ metric.value ? getMetric(metric.value[0]) : "" }}
                      <span *ngIf="metric.value?.length > 1">
                        (+{{ metric.value.length - 1 }}
                        {{ metric.value?.length === 2 ? "other" : "others" }})
                      </span>
                    </mat-select-trigger>
                    <mat-option
                      *ngFor="let m of selectedMetrics"
                      [value]="m.id"
                    >
                      {{ m.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="xsmall">
                <mat-form-field>
                  <input
                    matInput
                    type="number"
                    name="min"
                    formControlName="min"
                  />
                </mat-form-field>
              </div>

              <div class="xsmall">
                <mat-form-field>
                  <input
                    matInput
                    type="number"
                    name="max"
                    formControlName="max"
                  />
                </mat-form-field>
              </div>
              <div class="xsmall">
                <button
                  mat-icon-button
                  color="warn"
                  (click)="removeThreshold(i)"
                  aria-label="button that removes the threshold"
                >
                  <mat-icon> delete </mat-icon>
                </button>
              </div>

              <ng-template #default> default </ng-template>
            </div>
          </ng-container>
        </div>
      </ng-container>
    </ng-container>
  </form>
</div>
