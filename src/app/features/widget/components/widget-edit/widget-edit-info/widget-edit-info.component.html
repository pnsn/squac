<form action="" [formGroup]="widgetForm" (change)="checkValid()">
  <div class="column form-content">
    <div>
      <div class="label">Title:</div>
      <mat-form-field floatLabel="never" class="large">
        <input
          matInput
          type="text"
          id="name"
          formControlName="name"
          placeholder="Widget title"
          required
        />
        <mat-error *ngIf="widgetForm.get('name').hasError('required')"
          >Please add a title.</mat-error
        >
      </mat-form-field>
    </div>

    <div class="label">Widget type:</div>
    <mat-error
      *ngIf="widgetForm.touched && widgetForm.get('type').hasError('required')"
      >Please select a widget type.</mat-error
    >
    <div class="row" id="widget-type-container">
      <mat-button-toggle-group formControlName="type">
        <mat-button-toggle
          *ngFor="let widgetType of WidgetTypes | keyvalue"
          [value]="widgetType.value"
        >
          <div class="type-label">
            {{ WidgetTypeInfo[widgetType.value].config.name | titlecase }}
          </div>
        </mat-button-toggle>
      </mat-button-toggle-group>
      <div id="type-container" class="column">
        <div id="description" *ngIf="selectedType; else selectWidget">
          <div class="label">Description:</div>
          <p class="help-text">
            {{ selectedType?.description }}
          </p>
        </div>

        <ng-template #selectWidget>
          <p>Select a widget type.</p>
        </ng-template>
        <div id="stat-type-container" *ngIf="selectedType?.useAggregate">
          <div class="label">Select aggregation type:</div>
          <mat-form-field class="dense-form-field-select">
            <mat-label>Stat type</mat-label>
            <mat-select formControlName="stat" required>
              <mat-option
                *ngFor="let statType of WidgetStatTypes | keyvalue"
                [value]="statType.value"
              >
                {{ WidgetStatTypeNames[statType.value] }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div
          id="display-container"
          class="column"
          *ngIf="selectedType?.displayOptions"
        >
          <div class="label">Select display type:</div>
          <mat-radio-group
            formControlName="displayType"
            class="dense-radio-button-group"
          >
            <mat-radio-button
              *ngFor="let option of selectedType?.displayOptions | keyvalue"
              [value]="option.key"
              class="radio-button-dense"
              ><div class="option-container">
                <span>{{ option.value.description }}</span>
              </div>
            </mat-radio-button>
          </mat-radio-group>
        </div>

        <div id="chart-container">
          <div
            widgetTypeExample
            [type]="type"
            [displayType]="displayType"
            [properties]="properties"
            [stat]="stat"
          ></div>
        </div>
      </div>
    </div>
  </div>
</form>
