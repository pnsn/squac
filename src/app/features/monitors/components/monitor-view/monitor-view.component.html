<app-table-view title="Monitors" (refresh)="refresh()">
  <ng-container tableHeadControls>
    <button
      mat-icon-button
      aria-label="button that refreshes data"
      (click)="refresh()"
    >
      <mat-icon>refresh</mat-icon>
    </button>
    <a mat-button [routerLink]="['alerts']">View All Alerts</a>
    <button
      mat-flat-button
      color="accent"
      *ngIf="'update' | able: 'Monitor'"
      class="add-btn"
      (click)="addMonitor()"
    >
      Create Monitor
    </button>
  </ng-container>
  <ng-container tableHeadFilters> </ng-container>
  <ng-container tableBody options="options">
    <ngx-datatable
      #monitorTable
      class="shared-view-table"
      id="monitor-table"
      [rows]="rows"
      [groupRowsBy]="'monitorId'"
      [columnMode]="ColumnMode.force"
      [scrollbarH]="false"
      [groupExpansionDefault]="true"
      [rowHeight]="undefined"
    >
      <!-- Group Header Template -->
      <ngx-datatable-group-header
        [rowHeight]="50"
        #monitorHeader
        (toggle)="onDetailToggle($event)"
      >
        <ng-template let-group="group" ngx-datatable-group-header-template>
          <div
            class="monitor-container"
            *ngIf="group.value[0].monitor as monitor"
          >
            <div>
              <a href="javascript:void(0)">
                <b>{{ monitor.name }}</b>
              </a>
            </div>
            <div>
              {{ monitor.stat }}
            </div>
            <div>{{ monitor.intervalType }}</div>
            <div>{{ monitor.intervalCount }}</div>
            <div>{{ monitor.channelGroup.name }}</div>
            <div>{{ monitor.metric.name }}</div>
          </div>
        </ng-template>
      </ngx-datatable-group-header>
      <ngx-datatable-column
        name="State"
        width="80"
        [resizeable]="false"
        [canAutoResize]="false"
        [sortable]="false"
      >
        <ng-template ngx-datatable-cell-template let-row="row">
          {{ row.lastAlarm ? row.lastAlarm.inAlarm : "no" }}
          <ng-template #noAlert> false</ng-template>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column
        name="Conditions"
        [canAutoResize]="true"
        [minWidth]="300"
        [sortable]="false"
      >
        <ng-template ngx-datatable-cell-template let-row="row">
          Alarm if {{ row.num_channels_operator }}
          {{ row.num_channels }} channel(s) in
          {{ row.monitor.channelGroup.name }} are {{ row.value_operator }}
          {{ row.val1 }} {{ row.val2 }} in the last
          {{ row.monitor.intervalCount }}
          {{ row.monitor.intervalType }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column
        name="Actions"
        [sortable]="false"
        [width]="200"
        [canAutoResize]="false"
      >
        <ng-template ngx-datatable-cell-template let-row="row">
          {{ row.alert_on_out_of_alarm ? "alert when out" : "alert when in" }}
          {{ row.email_list ? "email" : "" }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column
        name="Recipients"
        [sortable]="false"
        [width]="200"
        [canAutoResize]="false"
      >
        <ng-template ngx-datatable-cell-template let-row="row">
          {{ row.email_list }}
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>
  </ng-container>
</app-table-view>

<!-- [scrollbarV]="50"
[rowHeight]="23"
[headerHeight]="50"
[footerHeight]="50"
[rowHeight]="40" -->
<router-outlet></router-outlet>
