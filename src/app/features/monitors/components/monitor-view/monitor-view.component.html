<div id="title">
  <h1>Monitors</h1>

  <div id="button-container">
    <button
      mat-icon-button
      aria-label="button that refreshes data"
      (click)="refresh()"
    >
      <mat-icon>refresh</mat-icon>
    </button>
    <a mat-button [routerLink]="['alerts']">View All Alerts</a>
    <button
      mat-flat-button
      color="accent"
      *ngIf="'update' | able: 'Monitor'"
      class="add-btn"
      (click)="addMonitor()"
    >
      Create Monitor
    </button>
  </div>
</div>

<!-- [scrollbarV]="50"
[rowHeight]="23"
[headerHeight]="50"
[footerHeight]="50"
[rowHeight]="40" -->

<div id="monitors" class="box">
  <ngx-datatable
    #monitorTable
    class="material"
    [rows]="triggers"
    [groupRowsBy]="'id'"
    [columnMode]="ColumnMode.force"
    [scrollbarH]="true"
    [groupExpansionDefault]="true"
    [headerHeight]="50"
    [footerHeight]="50"
    [rowHeight]="40"
  >
    <!-- Group Header Template -->
    <ngx-datatable-group-header
      [rowHeight]="50"
      #monitorHeader
      (toggle)="onDetailToggle($event)"
    >
      <ng-template
        let-group="group"
        let-expanded="expanded"
        ngx-datatable-group-header-template
      >
        <div
          class="monitor-container"
          *ngIf="getMonitor(group.value[0]?.monitorId)[0] as monitor"
        >
          {{ monitor?.name }}
          <div>
            <a
              [class.datatable-icon-right]="!expanded"
              [class.datatable-icon-down]="expanded"
              title="Expand/Collapse Group"
              (click)="toggleExpandGroup(group)"
            >
              <b>{{ monitor.name }}</b>
            </a>
            <span>
              {{ monitor.stat }}
              {{ monitor.intervalType }}
              {{ monitor.intervalCount }}
              {{ monitor.channelGroup.name }}
              {{ monitor.metric.name }}
            </span>
          </div>
        </div>
      </ng-template>
    </ngx-datatable-group-header>
    <ngx-datatable-column name="State">
      <ng-template ngx-datatable-cell-template let-row="row">
        {{ getAlert(row.id) }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Conditions">
      <ng-template ngx-datatable-cell-template let-row="row">
        {{ row.num_channels }} {{ row.num_channels_operator }}
        {{ row.value_operator }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Actions">
      <ng-template ngx-datatable-cell-template let-row="row">
        {{ row.alert_on_out_of_alarm ? "alert when out" : "alert when in" }}
        {{ row.email_list ? "email" : "" }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Recipients">
      <ng-template ngx-datatable-cell-template let-row="row">
        {{ row.email_list }}
      </ng-template>
    </ngx-datatable-column>
  </ngx-datatable>
</div>
<router-outlet></router-outlet>
