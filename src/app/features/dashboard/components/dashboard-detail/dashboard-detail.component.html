<div *ngIf="dashboard" id="dashboard-container">
  <mat-toolbar id="dashboard-header">
    <mat-toolbar-row>
      <div id="dashboard-info">
        <h2>
          {{ dashboard.name }}
        </h2>
        <span *ngIf="dashboard.owner && dashboard.orgId">
          by {{ dashboard.owner | user }} ({{ dashboard.orgId | organization }})
        </span>

        <shared-sharing-indicator
          [shareAll]="dashboard.shareAll"
          [shareOrg]="dashboard.shareOrg"
          resource="dashboard"
        ></shared-sharing-indicator>
      </div>
      <div id="header-controls">
        <button
          mat-stroked-button
          [matMenuTriggerFor]="dataType"
          matTooltip="Dashboard configuration"
          matTooltip="Select data type"
          aria-label="Button that opens menu to select data type"
        >
          {{ archiveType !== "raw" ? archiveStat + " of " : ""
          }}{{
            archiveType !== "raw"
              ? archiveType + " archive"
              : archiveType + " data"
          }}
        </button>
        <shared-date-select
          [secondsAgoFromNow]="this.viewService?.range"
          [initialStartDate]="this.viewService?.startdate"
          [initialEndDate]="this.viewService?.enddate"
          [timeRanges]="this.datePickerTimeRanges"
          (datesChanged)="datesChanged($event)"
        ></shared-date-select>

        <button
          mat-icon-button
          (click)="refreshData()"
          color="primary"
          matTooltip="Refresh data"
          aria-label="Button that requests new data from the database"
        >
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </mat-toolbar-row>
    <mat-toolbar-row>
      <div>
        <button
          mat-flat-button
          color="accent"
          (click)="save()"
          [disabled]="!unsaved"
          *ngIf="'update' | able: dashboard"
          matTooltip="Save dashboard"
          aria-label="Button that saves changes to the dashboard"
        >
          Save Dashboard
        </button>

        <button
          mat-flat-button
          [color]="!unsaved ? 'accent' : ''"
          (click)="addWidget()"
          *ngIf="'update' | able: dashboard"
          matTooltip="Add widget"
          aria-label="Button to add widget"
        >
          Add widget
        </button>

        <!-- if they have permission, otherwise show copy only -->
        <mat-menu
          #appMenu="matMenu"
          class="mat-menu-dense"
          yPosition="below"
          xPosition="before"
        >
          <button mat-menu-item (click)="editDashboard()">
            Edit Dashboard Information
          </button>
          <button
            mat-menu-item
            id="delete-dashboard"
            (click)="deleteDashboard()"
            *ngIf="'delete' | able: dashboard"
          >
            Delete Dashboard
          </button>
        </mat-menu>
        <mat-menu
          #dataType="matMenu"
          class="mat-menu-dense"
          yPosition="below"
          xPosition="after"
        >
          <button mat-menu-item (click)="selectArchiveType('raw', '')">
            <span> raw data </span>
          </button>
          <button mat-menu-item [matMenuTriggerFor]="dayArchiveStat">
            <span>day archives</span>
          </button>
          <button mat-menu-item [matMenuTriggerFor]="monthArchiveStat">
            <span> month archives </span>
          </button>
        </mat-menu>
        <mat-menu
          #dayArchiveStat="matMenu"
          class="mat-menu-dense"
          yPosition="below"
          xPosition="after"
        >
          <button
            mat-menu-item
            *ngFor="let item of archiveStatTypes"
            (click)="selectArchiveType('day', item)"
          >
            {{ item }}
          </button>
        </mat-menu>
        <mat-menu
          #monthArchiveStat="matMenu"
          class="mat-menu-dense"
          yPosition="below"
          xPosition="after"
        >
          <button
            mat-menu-item
            *ngFor="let item of archiveStatTypes"
            (click)="selectArchiveType('month', item)"
          >
            {{ item }}
          </button>
        </mat-menu>
        <button
          mat-icon-button
          [matMenuTriggerFor]="appMenu"
          color="primary"
          *ngIf="'update' | able: dashboard"
          matTooltip="Dashboard configuration"
        >
          <mat-icon>settings_application</mat-icon>
        </button>
      </div>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-progress-bar
    *ngIf="status && status !== 'finished'"
    [mode]="status !== 'error' ? 'indeterminate' : 'determinate'"
    value="1001"
    [color]="status === 'error' ? 'warn' : 'primary'"
  >
  </mat-progress-bar>

  <div id="dashboard-body">
    <router-outlet></router-outlet>
  </div>
</div>
<shared-error *ngIf="error" [errorMsg]="error"></shared-error>
<shared-loading *ngIf="!dashboard && !error"></shared-loading>
