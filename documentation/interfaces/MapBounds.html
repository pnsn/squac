<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>squac-ui documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">squac-ui documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  MapBounds</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/features/channel-group/components/channel-group-map/channel-group-map.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#latMax" 
>
                                            latMax
                                        </a>
                                </li>
                                <li>
                                        <a href="#latMin" 
>
                                            latMin
                                        </a>
                                </li>
                                <li>
                                        <a href="#lonMax" 
>
                                            lonMax
                                        </a>
                                </li>
                                <li>
                                        <a href="#lonMin" 
>
                                            lonMin
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="latMax"></a>
                                        <span class="name "><b>latMax</b>
                                            <a href="#latMax">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>latMax:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="latMin"></a>
                                        <span class="name "><b>latMin</b>
                                            <a href="#latMin">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>latMin:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lonMax"></a>
                                        <span class="name "><b>lonMax</b>
                                            <a href="#lonMax">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lonMax:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lonMin"></a>
                                        <span class="name "><b>lonMin</b>
                                            <a href="#lonMin">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lonMin:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  Component,
  Input,
  OnChanges,
  Output,
  EventEmitter,
  OnInit,
  SimpleChanges,
  NgZone,
} from &quot;@angular/core&quot;;
import { Channel } from &quot;@squacapi/models/channel&quot;;
import * as L from &quot;leaflet&quot;;

export interface MapBounds {
  latMin: number;
  latMax: number;
  lonMin: number;
  lonMax: number;
}
// shared map for channels
@Component({
  selector: &quot;channel-group-map&quot;,
  templateUrl: &quot;./channel-group-map.component.html&quot;,
  styleUrls: [&quot;./channel-group-map.component.scss&quot;],
})
export class ChannelGroupMapComponent implements OnInit, OnChanges {
  @Input() searchedChannels: Channel[]; // channels already in group
  @Input() autoExcludeChannels: Channel[];
  @Input() autoIncludeChannels: Channel[];
  @Input() selectedChannels: Channel[]; // channels selected
  @Input() editPage: boolean; //is used on edit page or not
  @Input() showChannel: Channel; // channel to show
  @Output() showChannelChange &#x3D; new EventEmitter&lt;any&gt;(); //channel to show changed
  @Output() boundsChange &#x3D; new EventEmitter&lt;MapBounds&gt;(); // in html (boundsChange)&#x3D;&quot;updateBounds($event)&quot;

  //leaflet stuff
  stationLayer: L.FeatureGroup;
  drawnItems: L.FeatureGroup;
  options: {
    center: L.LatLng;
    zoom: number;
    layers: L.Layer[];
  };
  legend: L.Control;
  drawOptions: Record&lt;string, unknown&gt;;
  layers: L.Layer[];
  fitBounds: L.LatLngBounds;
  rectLayer: any;
  map: L.Map;
  lastZoom &#x3D; null;

  constructor(private zone: NgZone) {}

  ngOnInit() {
    this.initMap();
  }

  ngOnChanges(changes: SimpleChanges) {
    if (
      changes.selectedChannels ||
      changes.autoIncludeChannels ||
      changes.autoExcludeChannels ||
      changes.searchedChannels
    ) {
      this.updateMap(!!changes.showChannel);
    }
    if (!changes.selectedChannels &amp;&amp; changes.showChannel) {
      this.selectChannels(this.showChannel);
    }
  }

  initMap(): void {
    // Setup the groups for map markers and the drawn square
    this.stationLayer &#x3D; new L.FeatureGroup();
    this.drawnItems &#x3D; new L.FeatureGroup();

    this.legend &#x3D; new L.Control({
      position: &quot;bottomleft&quot;,
    });

    // Add all the layers to the array that will be fed to options
    this.layers &#x3D; [
      L.tileLayer(&quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;, {
        attribution:
          &#x27;&amp;copy; &lt;a href&#x3D;&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&#x27;,
      }),
      this.drawnItems,
      this.stationLayer,
    ];

    const legend &#x3D; L.DomUtil.get(&quot;legend&quot;);
    this.legend.onAdd &#x3D; () &#x3D;&gt; {
      return legend;
    };

    // Giving options before view is initialized seemed to be causing issues with the map, so for init just fed it undefineds
    this.options &#x3D; {
      center: L.latLng(0, 0),
      zoom: 5,
      layers: this.layers,
    };

    // Options for the drawing menu
    this.drawOptions &#x3D; {
      position: &quot;topright&quot;,
      draw: {
        polygon: false,
        polyline: false,
        rectangle: {
          showArea: false, // disable showArea
        },
        circle: false,
        circlemarker: false,
        marker: false,
      },
      edit: { featureGroup: this.drawnItems },
    };
  }

  // leaflet event for when map has loaded
  // can save map and init things on map now
  onMapReady(map: L.Map): void {
    this.map &#x3D; map;
    this.legend.addTo(this.map);
    setTimeout(() &#x3D;&gt; {
      this.map.invalidateSize();
      this.updateMap(false);
    }, 0);
  }

  // find station to show when channel is selected
  selectChannels(channel: Channel): void {
    if (channel) {
      let stationMarker;
      this.stationLayer.eachLayer((layer: any) &#x3D;&gt; {
        if (layer.options.title &#x3D;&#x3D;&#x3D; channel.staCode) {
          stationMarker &#x3D; layer;
        }

        // layer.title &#x3D;&#x3D;&#x3D; channel.nslc;
      });
      if (stationMarker) {
        stationMarker.openPopup();
      }
    }
  }

  // Create markers for each station
  updateMap(showChannel: boolean): void {
    const stations &#x3D; [];
    if (this.stationLayer) {
      this.layers.pop();
      const stationMarkers &#x3D; []; // Marker array

      this.searchedChannels?.forEach((channel) &#x3D;&gt; {
        let station &#x3D; stations.find((s) &#x3D;&gt; {
          return s.code &#x3D;&#x3D;&#x3D; channel.staCode;
        });

        if (!station) {
          // make station if there isn&#x27;t one yet
          station &#x3D; {
            code: channel.staCode,
            lat: channel.lat,
            lon: channel.lon,
            autoIncludeChannels: [],
            autoExcludeChannels: [],
            selectedChannels: [],
            searchedChannels: [],
          };
          stations.push(station);
        }

        station.searchedChannels.push(channel);
      });

      this.autoIncludeChannels?.forEach((channel) &#x3D;&gt; {
        let station &#x3D; stations.find((s) &#x3D;&gt; {
          return s.code &#x3D;&#x3D;&#x3D; channel.staCode;
        });

        if (!station) {
          // make station if there isn&#x27;t one yet
          station &#x3D; {
            code: channel.staCode,
            lat: channel.lat,
            lon: channel.lon,
            autoIncludeChannels: [],
            autoExcludeChannels: [],
            selectedChannels: [],
            searchedChannels: [],
          };
          stations.push(station);
        }

        station.autoIncludeChannels.push(channel);
      });

      this.autoExcludeChannels?.forEach((channel) &#x3D;&gt; {
        let station &#x3D; stations.find((s) &#x3D;&gt; {
          return s.code &#x3D;&#x3D;&#x3D; channel.staCode;
        });

        if (!station) {
          // make station if there isn&#x27;t one yet
          station &#x3D; {
            code: channel.staCode,
            lat: channel.lat,
            lon: channel.lon,
            autoIncludeChannels: [],
            autoExcludeChannels: [],
            selectedChannels: [],
            searchedChannels: [],
          };
          stations.push(station);
        }

        station.autoExcludeChannels.push(channel);
      });

      this.selectedChannels?.forEach((channel) &#x3D;&gt; {
        let station &#x3D; stations.find((s) &#x3D;&gt; {
          return s.code &#x3D;&#x3D;&#x3D; channel.staCode;
        });

        if (!station) {
          station &#x3D; {
            code: channel.staCode,
            lat: channel.lat,
            lon: channel.lon,
            autoIncludeChannels: [],
            autoExcludeChannels: [],
            selectedChannels: [],
            searchedChannels: [],
          };
          stations.push(station);
        }

        // check if station is already in the group
        const includeIndex &#x3D; station.autoIncludeChannels.findIndex(
          (c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; channel.id
        );

        const excludeIndex &#x3D; station.autoExcludeChannels.findIndex(
          (c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; channel.id
        );

        if (includeIndex &gt; -1) {
          //remove channel from ingroups to stop duplicates
          station.autoIncludeChannels.splice(includeIndex, 1);
        }

        if (excludeIndex &gt; -1) {
          station.autoExcludeChannels.splice(includeIndex, 1);
        }

        station.selectedChannels.push(channel);
      });

      //make marker for each station
      stations.forEach((station) &#x3D;&gt; {
        const marker &#x3D; this.makeMarker(station);
        stationMarkers.push(marker);
      });

      // create layer from markers
      this.stationLayer &#x3D; L.featureGroup(stationMarkers);
      this.layers.push(this.stationLayer);

      // only reset map zoom &amp; bounds if user hasn&#x27;t yet
      if (!this.lastZoom || this.lastZoom !&#x3D;&#x3D; &quot;user&quot;) {
        try {
          // adjust bounds to fit stations
          const bounds &#x3D; this.stationLayer.getBounds();
          this.map.fitBounds(bounds, {
            padding: [11, 11],
          });
        } catch {
          this.map.setZoom(1);
        }
        this.lastZoom &#x3D; &quot;auto&quot;;
      }

      // show selected channel
      if (showChannel) {
        this.selectChannels(this.showChannel);
      }
    }
  }

  // Make leaflet marker for station
  makeMarker(station): L.Marker {
    let selectedChannelString &#x3D; &quot;&quot;;
    let inGroupChannelString &#x3D; &quot;&quot;;
    station.searchedChannels.forEach((channel) &#x3D;&gt; {
      inGroupChannelString +&#x3D;
        &quot;&lt;div&gt; &lt;div class&#x3D;&#x27;searched-channels map-icon&#x27;&gt;&lt;/div&gt;&quot; +
        channel.nslc +
        &quot;&lt;/div&gt;&quot;;
    });

    station.autoIncludeChannels.forEach((channel) &#x3D;&gt; {
      inGroupChannelString +&#x3D;
        &quot;&lt;div&gt; &lt;div class&#x3D;&#x27;included-channels map-icon&#x27;&gt;&lt;/div&gt;&quot; +
        channel.nslc +
        &quot;&lt;/div&gt;&quot;;
    });
    station.autoExcludeChannels.forEach((channel) &#x3D;&gt; {
      inGroupChannelString +&#x3D;
        &quot;&lt;div&gt; &lt;div class&#x3D;&#x27;excluded-channels map-icon&#x27;&gt;&lt;/div&gt;&quot; +
        channel.nslc +
        &quot;&lt;/div&gt;&quot;;
    });
    station.selectedChannels.forEach((channel) &#x3D;&gt; {
      selectedChannelString +&#x3D;
        &quot;&lt;div&gt; &lt;div class&#x3D;&#x27;new-channels map-icon&#x27;&gt;&lt;/div&gt;&quot; +
        channel.nslc +
        &quot;&lt;/div&gt;&quot;;
    });

    let className &#x3D; &quot;&quot;;

    if (station.searchedChannels.length !&#x3D;&#x3D; 0) {
      className &#x3D; &quot;searched-channels&quot;;
    }

    if (station.autoIncludeChannels.length !&#x3D;&#x3D; 0) {
      className &#x3D; &quot;included-channels&quot;;
    }
    if (station.autoExcludeChannels.length !&#x3D;&#x3D; 0) {
      className &#x3D; &quot;excluded-channels&quot;;
    }
    if (station.selectedChannels.length !&#x3D;&#x3D; 0) {
      className &#x3D; &quot;new-channels&quot;;
    }

    const popup &#x3D; &#x60;&lt;h4&gt; ${station.code} &lt;/h4&gt; &lt;div class&#x3D;&#x27;channel-list&#x27;&gt;${selectedChannelString}&lt;/div&gt; &lt;div class&#x3D;&#x27;channel-list&#x27;&gt;${inGroupChannelString} &lt;/div&gt;&#x60;;
    const marker &#x3D; L.marker([station.lat, station.lon], {
      icon: L.divIcon({ className: className }),
      title: station.code,
    }).bindPopup(popup);

    marker.on(&quot;click&quot;, (ev) &#x3D;&gt; {
      ev.target.openPopup();
      this.zone.run(() &#x3D;&gt; {
        //ToDO: need to actually select channels
        this.showChannelChange.emit(station);
      });
    });

    return marker;
  }

  // after zoom triggers
  // if user changed bounds, don&#x27;t override
  onZoomEnd(): void {
    if (this.lastZoom &#x3D;&#x3D;&#x3D; &quot;auto&quot;) {
      this.lastZoom &#x3D; null;
    } else {
      this.lastZoom &#x3D; &quot;user&quot;;
    }
  }
  // Clear out old stuff and remove bounds
  onDrawStart(): void {
    this.drawnItems.clearLayers();
    // this.boundsChange.emit(&quot;&quot;);
  }

  // take leaflet rectangle and get bounds and emit results
  getBoundsFromRectangle(): void {
    const rectangleNE &#x3D; this.rectLayer._bounds._northEast; // Northeast corner lat lng
    const rectangleSW &#x3D; this.rectLayer._bounds._southWest; // Southwest corner lat lng
    const bounds: MapBounds &#x3D; {
      latMax: rectangleNE.lat,
      latMin: rectangleSW.lat,
      lonMin: rectangleSW.lng,
      lonMax: rectangleNE.lng,
    };
    this.boundsChange.emit(bounds);
  }

  // Send out newly drawn bounds
  onRectangleCreated(e: any): void {
    this.rectLayer &#x3D; e.layer;
    this.drawnItems.addLayer((e as L.DrawEvents.Created).layer);

    this.getBoundsFromRectangle();
  }

  // Listen to rectangle edit and change bounds
  onRectangleEdited(): void {
    this.getBoundsFromRectangle();
  }

  // clear bounds when rectangle deleted
  onRectangleDeleted(): void {
    this.boundsChange.emit(); // Clear old bounds
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'MapBounds.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
