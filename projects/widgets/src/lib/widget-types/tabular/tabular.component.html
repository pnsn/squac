<!-- *ngIF causes chaos avoid in ngx-datatable -->
<ngx-datatable
  #dataTable
  class="material expandable tabular-table"
  [rows]="rows"
  [columns]="columns"
  [headerHeight]="25"
  [sortType]="SortType.single"
  [columnMode]="ColumnMode.force"
  [selectionType]="SelectionType.single"
  [footerHeight]="0"
  [rowHeight]="20"
  [scrollbarH]="true"
  [scrollbarV]="true"
  [messages]="messages"
  [treeFromRelation]="'parentId'"
  [treeToRelation]="'id'"
  (treeAction)="onTreeAction($event)"
  [selected]="selectedRow"
  [sorts]="sorts"
>
</ngx-datatable>
<ng-template
  #headerTemplate
  let-column="column"
  let-sort="sortFn"
  ngx-datatable-header-template
>
  <div class="header-cell datatable-header-cell-wrapper" (click)="sort()">
    <span>{{ column.name }}</span>
  </div>
</ng-template>

<ng-template #cellTemplate let-value="value" let-row="row">
  <ng-container *ngIf="row.type === 'stoplight'; else notStoplight">
    <span
      class="cell-full"
      [ngClass]="{ border: value.color === 'white' }"
      [ngStyle]="{ 'background-color': value.color }"
    ></span>
  </ng-container>

  <ng-template #notStoplight>
    <ng-container *ngIf="value.value !== null; else noValue">
      <div
        *ngIf="showKey"
        class="cell-icon"
        [ngClass]="{ border: value.color === 'white' }"
        [ngStyle]="{ 'background-color': value.color }"
      ></div>
      <span *ngIf="showKey">{{ value.value | precision }}</span>
      <div
        *ngIf="!showKey"
        class="cell-full"
        [ngClass]="{
          border: value.color === 'gray' || value.color === '#808080'
        }"
        [ngStyle]="{ 'background-color': value.color, color: value.color }"
      >
        <span>
          {{ value.value | precision }}
        </span>
      </div>
    </ng-container>
  </ng-template>

  <ng-template #noValue>
    <span>no data</span>
  </ng-template>
</ng-template>
