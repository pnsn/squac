<div id="group-view-container" class="box">
  <div class="header-title">
    <div id="channel-group-info">
      <h3>{{ monitor?.name }}</h3>
      <span class="help-text"> by {{ monitor?.owner | user }} </span>
    </div>
    <div id="button-container row space-between">
      <button
        *ngIf="'delete' | able: monitor"
        mat-icon-button
        color="warn"
        (click)="onDelete()"
        matTooltip="Delete monitor"
        aria-label="Button that deletes the monitor"
      >
        <mat-icon>delete</mat-icon>
      </button>
      <button
        *ngIf="'create' | able: 'Monitor'"
        mat-icon-button
        (click)="addNewMonitor()"
        matTooltip="Create new monitor"
        aria-label="Button that creates new monitor"
      >
        <mat-icon>add</mat-icon>
      </button>
      <button
        *ngIf="'update' | able: monitor"
        mat-icon-button
        color="primary"
        (click)="editMonitor()"
        matTooltip="Edit monitor"
        aria-label="Button that navigates to edit monitor page"
      >
        <mat-icon>edit</mat-icon>
      </button>
      <button
        mat-icon-button
        (click)="closeMonitor()"
        matTooltip="Close monitor"
        aria-label="Button that navigates to all monitors"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div id="monitor-container" class="column">
    <div class="row space-between">
      <div>
        <p>
          <strong>Metric: </strong> {{ monitor.stat }} of
          {{ monitor.metricName }}
        </p>
        <p>
          <strong> Channel Group: </strong
          ><a [routerLink]="['/channel-groups', monitor.channelGroupId]">
            {{ monitor.channelGroupName }}</a
          >
        </p>
        <p>
          <strong>Interval: </strong> {{ monitor.intervalCount }}
          {{ monitor.intervalType }}
        </p>
      </div>
      <div class="row">
        <shared-date-select
          [secondsAgoFromNow]="timeRange"
          [initialStartDate]="starttime"
          [initialEndDate]="endtime"
          [timeRanges]="datePickerTimeRanges"
          (datesChanged)="datesChanged($event)"
        >
        </shared-date-select>
        <button mat-raised-button color="accent" (click)="update()">
          Update
        </button>
      </div>
    </div>
  </div>

  <div
    id="monitor-history-chart-container"
    [appIsLoading]="loadingService.isLoading(this)"
  >
    <h3>Alert History</h3>
    <p class="help-text">click on an alert to view details</p>
    <monitor-history-chart
      *ngIf="alerts?.length > 0; else noAlerts"
      #monitorChart
      [monitor]="monitor"
      [alerts]="alerts"
      [(selectedAlert)]="selectedAlert"
    ></monitor-history-chart>
  </div>
  <div *ngIf="selectedAlert as alert" id="alert-detail">
    <h3>Alert</h3>
    <strong>Evaluated at: </strong>{{ alert.timestamp }}
    <table>
      <thead>
        <td>Channel</td>
        <td>{{ this.monitor.stat }}</td>
      </thead>
      <tbody>
        <tr *ngFor="let channel of alert.breachingChannels">
          <td>{{ channel.channel }}</td>
          <td>{{ channel[this.monitor.stat] }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<ng-template #noAlerts>
  <div>No alerts found in this time range.</div>
</ng-template>

<!-- <shared-table-view
  title="Alerts"
  [isLoading]="loadingService.isLoading(this)"
  [options]="options"
  [columns]="columns"
  [controls]="controls"
  (refresh)="refresh()"
  [rows]="alerts"
>
</shared-table-view> -->
